<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«é›· | æˆ‘çš„ä½œå“é›†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #111827;
            font-family: Arial, sans-serif;
            color: #e5e5e5;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 400px;
            margin-bottom: 10px;
            padding: 8px 20px;
            background-color: #1f2937;
            border: 2px solid #fbbf24;
            border-radius: 8px;
        }

        .info-item {
            color: #fbbf24;
            font-size: 24px;
            font-weight: bold;
        }

        .game-container {
            position: relative;
        }

        #minesweeperBoard {
            display: grid;
            grid-template-columns: repeat(16, 25px);
            gap: 1px;
            background-color: #1f2937;
            border: 2px solid #fbbf24;
        }

        .cell {
            width: 25px;
            height: 25px;
            background-color: #374151;
            border: none;
            color: #e5e5e5;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .cell:hover:not(.opened):not(.flagged):not(.mine) {
            background-color: #4b5563;
        }

        .cell.opened {
            background-color: #1f2937;
            cursor: default;
        }

        .cell.flagged {
            color: #ef4444;
        }

        .cell.mine {
            color: #ef4444;
            background-color: #1f2937;
        }

        .cell.num1 {
            color: #3b82f6;
        }

        .cell.num2 {
            color: #22c55e;
        }

        .cell.num3 {
            color: #ef4444;
        }

        .cell.num4 {
            color: #8b5cf6;
        }

        .cell.num5 {
            color: #f97316;
        }

        .cell.num6 {
            color: #06b6d4;
        }

        .cell.num7 {
            color: #fbbf24;
        }

        .cell.num8 {
            color: #f87171;
        }

        /* ä»…ä¿ç•™ç»“æŸ/èƒœåˆ©æç¤ºï¼Œåˆ æ‰å¼€å§‹/æš‚åœæç¤ºæ ·å¼ */
        .game-over,
        .game-win {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 10;
            background: rgba(17, 24, 39, 0.9);
            padding: 20px 40px;
            border-radius: 10px;
            display: none;
        }

        .game-over {
            color: #ef4444;
        }

        .game-win {
            color: #22c55e;
        }

        .tips {
            color: #94a3b8;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="game-info">
        <div class="info-item">é›·æ•°ï¼š<span id="mineCount">40</span></div>
        <div class="info-item">è®¡æ—¶ï¼š<span id="gameTime">0</span>s</div>
    </div>

    <div class="game-container">
        <!-- åˆ æ‰å¼€å§‹/æš‚åœæç¤ºï¼Œä»…ä¿ç•™ç»“æŸ/èƒœåˆ©æç¤º -->
        <div class="game-over">Game Over</div>
        <div class="game-win">You Win</div>
        <div id="minesweeperBoard"></div>
    </div>

    <!-- ç®€åŒ–æ“ä½œè¯´æ˜ï¼ŒEé”®ä»…æ ‡æ³¨é‡ç© -->
    <div class="tips">æ“ä½œè¯´æ˜ï¼šå·¦é”®ç‚¹å¼€æ ¼å­ | å³é”®æ ‡è®°åœ°é›· | E é‡æ–°å¼€å§‹ | 40é›·/16*16æ£‹ç›˜</div>

    <script>
        // æ¸¸æˆåŸºç¡€é…ç½®
        const ROWS = 16;
        const COLS = 16;
        const MINE_COUNT = 40;
        // DOMå…ƒç´ è·å–
        const board = document.getElementById('minesweeperBoard');
        const mineCountEl = document.getElementById('mineCount');
        const gameTimeEl = document.getElementById('gameTime');
        const gameOverEl = document.querySelector('.game-over');
        const gameWinEl = document.querySelector('.game-win');

        // æ¸¸æˆçŠ¶æ€å˜é‡ï¼ˆåˆ æ‰æš‚åœç›¸å…³å˜é‡ï¼Œç®€åŒ–çŠ¶æ€ï¼‰
        let minePositions = new Set();
        let flaggedCount = 0;
        let openedCount = 0;
        let gameOver = false;
        let gameTimer = null;
        let gameTime = 0;

        // åˆå§‹åŒ–æ£‹ç›˜DOM - åˆ›å»ºæ‰€æœ‰æ ¼å­æŒ‰é’®
        function initBoardDOM() {
            board.innerHTML = '';
            for (let i = 0; i < ROWS; i++) {
                for (let j = 0; j < COLS; j++) {
                    const cell = document.createElement('button');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener('click', () => openCell(i, j));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        flagCell(i, j);
                    });
                    board.appendChild(cell);
                }
            }
        }

        // ç”Ÿæˆåœ°é›· - é¿å¼€é¦–æ¬¡ç‚¹å‡»çš„æ ¼å­ï¼Œé˜²æ­¢å¼€å±€è¸©é›·
        function generateMines(avoidRow, avoidCol) {
            minePositions.clear();
            while (minePositions.size < MINE_COUNT) {
                const row = Math.floor(Math.random() * ROWS);
                const col = Math.floor(Math.random() * COLS);
                if (row !== avoidRow || col !== avoidCol) {
                    minePositions.add(`${row},${col}`);
                }
            }
        }

        // è®¡ç®—æŒ‡å®šæ ¼å­å‘¨å›´çš„åœ°é›·æ•°é‡
        function getSurroundingMines(row, col) {
            let mineNum = 0;
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue;
                    const newRow = row + i;
                    const newCol = col + j;
                    if (newRow >= 0 && newRow < ROWS && newCol >= 0 && newCol < COLS) {
                        if (minePositions.has(`${newRow},${newCol}`)) mineNum++;
                    }
                }
            }
            return mineNum;
        }

        // æ‰“å¼€æ ¼å­ - æ ¸å¿ƒé€»è¾‘ï¼ˆåˆ æ‰æ‰€æœ‰æš‚åœåˆ¤æ–­ï¼‰
        function openCell(row, col) {
            if (gameOver || isCellFlagged(row, col) || isCellOpened(row, col)) return;

            const cell = getCellElement(row, col);
            // è¸©ä¸­åœ°é›· - æ¸¸æˆç»“æŸ
            if (minePositions.has(`${row},${col}`)) {
                gameOver = true;
                clearInterval(gameTimer);
                gameOverEl.style.display = 'block';
                showAllMines();
                return;
            }

            // é¦–æ¬¡æ‰“å¼€æ ¼å­ - ç”Ÿæˆåœ°é›·+å¯åŠ¨è®¡æ—¶ï¼ˆåŠ è½½åç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼‰
            if (minePositions.size === 0) {
                generateMines(row, col);
                startTimer();
            }

            // æ ‡è®°æ ¼å­ä¸ºå·²æ‰“å¼€å¹¶æ›´æ–°è®¡æ•°
            cell.classList.add('opened');
            openedCount++;
            const surMineNum = getSurroundingMines(row, col);

            // æ˜¾ç¤ºå‘¨å›´é›·æ•°æˆ–é€’å½’æ‰«ç©ºæ— é›·åŒºåŸŸ
            if (surMineNum > 0) {
                cell.textContent = surMineNum;
                cell.classList.add(`num${surMineNum}`);
            } else {
                for (let i = -1; i <= 1; i++) {
                    for (let j = -1; j <= 1; j++) {
                        if (i === 0 && j === 0) continue;
                        const newRow = row + i;
                        const newCol = col + j;
                        if (newRow >= 0 && newRow < ROWS && newCol >= 0 && newCol < COLS) {
                            openCell(newRow, newCol);
                        }
                    }
                }
            }

            // èƒœåˆ©åˆ¤æ–­
            if (openedCount === ROWS * COLS - MINE_COUNT) {
                gameOver = true;
                clearInterval(gameTimer);
                gameWinEl.style.display = 'block';
                flagAllMines();
            }
        }

        // æ ‡è®°/å–æ¶ˆæ ‡è®°åœ°é›·ï¼ˆåˆ æ‰æš‚åœåˆ¤æ–­ï¼‰
        function flagCell(row, col) {
            if (gameOver || isCellOpened(row, col)) return;

            const cell = getCellElement(row, col);
            if (cell.classList.contains('flagged')) {
                cell.classList.remove('flagged');
                cell.textContent = '';
                flaggedCount--;
            } else if (flaggedCount < MINE_COUNT) {
                cell.classList.add('flagged');
                cell.textContent = 'âš';
                flaggedCount++;
            }
            mineCountEl.textContent = MINE_COUNT - flaggedCount;
        }

        // æ¸¸æˆç»“æŸ - æ˜¾ç¤ºæ‰€æœ‰åœ°é›·
        function showAllMines() {
            minePositions.forEach(pos => {
                const [row, col] = pos.split(',').map(Number);
                const cell = getCellElement(row, col);
                if (!cell.classList.contains('flagged')) {
                    cell.classList.add('mine');
                    cell.textContent = 'ğŸ’£';
                }
            });
        }

        // æ¸¸æˆèƒœåˆ© - è‡ªåŠ¨æ ‡è®°æ‰€æœ‰åœ°é›·
        function flagAllMines() {
            minePositions.forEach(pos => {
                const [row, col] = pos.split(',').map(Number);
                const cell = getCellElement(row, col);
                if (!cell.classList.contains('flagged')) {
                    cell.classList.add('flagged');
                    cell.textContent = 'âš';
                }
            });
            mineCountEl.textContent = 0;
        }

        // å¯åŠ¨æ¸¸æˆè®¡æ—¶ï¼ˆåˆ æ‰æš‚åœåˆ¤æ–­ï¼Œè®¡æ—¶å…¨ç¨‹è¿è¡Œï¼‰
        function startTimer() {
            clearInterval(gameTimer);
            gameTime = 0;
            gameTimeEl.textContent = gameTime;
            gameTimer = setInterval(() => {
                gameTime++;
                gameTimeEl.textContent = gameTime;
            }, 1000);
        }

        // é‡ç½®æ¸¸æˆ - Eé”®ä»…æ‰§è¡Œæ­¤åŠŸèƒ½ï¼ˆåŠ è½½åæ— éœ€è°ƒç”¨ï¼Œä»…é‡ç©ç”¨ï¼‰
        function resetGame() {
            // é‡ç½®æ‰€æœ‰æ¸¸æˆçŠ¶æ€
            gameOver = false;
            flaggedCount = 0;
            openedCount = 0;
            gameTime = 0;
            minePositions.clear();
            // é‡ç½®DOMæ˜¾ç¤º
            gameOverEl.style.display = 'none';
            gameWinEl.style.display = 'none';
            mineCountEl.textContent = MINE_COUNT;
            gameTimeEl.textContent = 0;
            // æ¸…é™¤å®šæ—¶å™¨ï¼Œé‡æ–°åˆå§‹åŒ–æ£‹ç›˜
            clearInterval(gameTimer);
            initBoardDOM();
        }

        // å·¥å…·å‡½æ•°
        function getCellElement(row, col) {
            return document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
        }
        function isCellOpened(row, col) {
            return getCellElement(row, col).classList.contains('opened');
        }
        function isCellFlagged(row, col) {
            return getCellElement(row, col).classList.contains('flagged');
        }

        // é”®ç›˜æ§åˆ¶ - ä»…ä¿ç•™Eé”®é‡ç©åŠŸèƒ½
        document.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 'e') {
                resetGame();
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆ - ç›´æ¥åˆå§‹åŒ–æ£‹ç›˜ï¼Œæ— éœ€æŒ‰Eï¼Œé»˜è®¤å¼€å§‹
        window.addEventListener('load', initBoardDOM);
    </script>
</body>

</html>